"use strict";function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}function r(t){var e=t.split("").map(function(t){return t.charCodeAt(0)});return new Uint8Array(e).buffer}var n=function(){function t(e){if(this.options=e,this.precedents=[],this.options){if(this.options.centered&&this.options.getImage)throw new Error("Centered option is not supported on this image module");if(this.options.centered&&this.options.getSize)throw new Error("Centered option is not supported on this image module")}this.imgManagers=[],this.imgId=1}return e(t,[{key:"clone",value:function(){return new t(this.options)}},{key:"set",value:function(t){t.inspect&&t.inspect.filePath&&(this.filePath=t.inspect.filePath)}},{key:"get",value:function(t){var e=this,n={};return t.moduleName===this.name?(n.replaceImages=function(r){return Promise.all(e.imgManagers.map(function(t){return t.replaceImgs()})).then(function(t){return n.imgManagers=e.imgManagers,t})},n.getImgs=function(){return n.imgManagers=e.imgManagers,e.imgManagers},n):null}},{key:"render",value:function(t,e){if("image"===t.type){var n,i=t.value,o=e.scopeManager.getValue(i,{part:t});if(!o)return{type:"null"};var a=this.options.getImage(o,i);if(!a)return{type:"null"};"string"==typeof a&&(a=r(a));var s=this.options.getSize(a,o,i);return this.imgId++,n={type:"image",moduleId:this.name,imgId:this.imgId,value:a,size:s},this.imgManagers.push(n),n}return null}},{key:"resolve",value:function(t,e,r){var n=this;if("image"===t.type&&t.moduleId===this.name)return new Promise(function(e,i){var o=n.imgManagers.indexOf(t),a=r.part.getCentered(t.size);return t.centered=a,n.imgManagers[o]=t,e({value:a})})}}]),t}();"undefined"!=typeof window&&(window.ImageModule=n),"undefined"!=typeof module&&module.exports&&(module.exports=n);
