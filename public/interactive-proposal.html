<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Proposal for {Account}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 11pt;
            line-height: 1.4;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            counter-reset: section;
        }
        .page {
            position: relative;
            width: 210mm;
            min-height: 297mm;
            padding: 20mm;
            margin: 10mm auto;
            border: 1px #D3D3D3 solid;
            background: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }
        .header, .footer {
            position: absolute;
            width: calc(100% - 40mm);
            font-size: 9pt;
            color: #777;
        }
        .header { top: 10mm; right: 20mm; text-align: right; }
        .header img { width: 100px; }
        .footer { bottom: 10mm; left: 20mm; display: flex; justify-content: space-between; }
        h1, h2, h3, h4 { color: #386682; line-height: 1.2; font-weight: bold; }
        h1 { font-size: 28pt; text-align: center; margin-top: 50px;}
        h2 {
            font-size: 20pt;
            text-align: left;
            border-bottom: 2px solid #386682;
            padding-bottom: 10px;
            margin-top: 40px;
            margin-bottom: 20px;
        }
        h2:not(.no-number)::before {
            counter-increment: section;
            counter-reset: subsection;
            content: counter(section) ". ";
            margin-right: 8px;
        }
        h3 { font-size: 16pt; margin-top: 30px; }
        h3:not(.no-number)::before {
            counter-increment: subsection;
            content: counter(section) "." counter(subsection) ". ";
            margin-right: 8px;
        }
        p, li { margin-bottom: 1em; }
        ul { padding-left: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 10pt; }
        th, td { border: 1px solid #cccccc; padding: 8px; text-align: left; vertical-align: top; }
        th { background-color: #386682; color: white; font-weight: bold; }
        .pricing-table td:nth-child(2), .pricing-table td:nth-child(3), .pricing-table td:nth-child(4) { text-align: right; }
        .total-row td { font-weight: bold; }
        img { max-width: 100%; height: auto; display: block; margin: 20px auto; }
        .cover-logo { width: 500px; margin: 40px auto 20px; }
        .cover-title { text-align: center; font-size: 48pt; color: #386682; line-height: 1.5; margin-top: 20px; }
        .toc { list-style-type: none; padding-left: 0; }
        .toc li a { text-decoration: none; color: #333; display: flex; justify-content: space-between; }
        .toc li a:hover { color: #386682; }
        .toc li { margin-bottom: 10px; }
        .toc-h2 { font-weight: bold; }
        .toc-h3 { padding-left: 20px; }
        .component-layout { display: flex; gap: 20px; align-items: center; margin-bottom: 30px; }
        .component-layout.reverse { flex-direction: row-reverse; }
        .image-container { flex: 1; }
        .text-container { flex: 2; }
        .text-container h3 { margin-top: 0; }
        .support-tier-option { cursor: pointer; }
        .support-tier-option:hover { background-color: #f0f8ff; }
        .support-tier-option.selected { background-color: #d4edda; font-weight: bold; }
    </style>
</head>
<body>

<div id="proposal-container">
    <div class="page cover-page">
        <img class="cover-logo" src="images/uctel_logo.png" alt="UCtel Logo">
        <div class="cover-title">
            Budgetary CEL-FI<br>
            {Solution}<br>
            proposal<br>
            for<br>
            {Account}
        </div>
    </div>

    <div class="page toc-page">
        <div class="header"><img src="images/uctel_logo.png" alt="UCtel Logo"></div>
        <h2 class="no-number">CONTENTS</h2>
        <ul class="toc" id="toc-list"></ul>
        <div class="footer"><span>CEL-FI {Solution} solution proposal for {Account}</span><span class="page-number"></span></div>
    </div>

    <div class="page">
        <div class="header"><img src="images/uctel_logo.png" alt="UCtel Logo"></div>
        <h2>Introduction</h2>
        <p>{Account} are looking to install a mobile boosting system to improve indoor mobile coverage. Coverage is required over {NumberOfNetworks} of the UK Mobile Network Operators (MNOs) – EE, O2, Vodafone and Three (3). Based on the information provided, UCtel proposes the use of the CEL-FI {Solution} solution. This document sets out the details of the proposed solution, UCtel’s approach and budgetary pricing.</p>
        <h3 class="no-number">About UCtel</h3>
        <p>UCtel specialises in the design, installation and management of in-building mobile signal systems.</p>
        <h4 class="no-number">Why UCtel:</h4>
        <ul>
            <li>We have been installing in building mobile signal systems since 2019 and have deployed over 300 systems in a wide range of buildings including private houses, offices, factories and hospitals</li>
            <li>We only work with equipment that complies with Ofcom's UK Interface Requirement 2102</li>
            <li>We provide a range of tailored support packages from break/fix maintenance to fully managed systems with onsite engineering support.</li>
        </ul>
        <h3 class="no-number">Key Contacts</h3>
        <table>
            <tr><th>Name</th><th>Title</th><th>Contact Details</th></tr>
            <tr><td>Ivor Nicholls</td><td>Sales Director</td><td>ivor.nicholls@uctel.co.uk</td></tr>
            <tr><td>Ivan Romanov</td><td>Technical Director</td><td>ivan.romanov@uctel.co.uk</td></tr>
        </table>
        <div class="footer"><span>CEL-FI {Solution} solution proposal for {Account}</span><span class="page-number"></span></div>
    </div>

    <div class="page">
        <div class="header"><img src="images/uctel_logo.png" alt="UCtel Logo"></div>
        <div id="solution-architecture-section">
            </div>
        <div class="footer"><span>CEL-FI {Solution} solution proposal for {Account}</span><span class="page-number"></span></div>
    </div>

    <div class="page">
        <div class="header"><img src="images/uctel_logo.png" alt="UCtel Logo"></div>
        <div id="solution-components-section">
            </div>
        <div class="footer"><span>CEL-FI {Solution} solution proposal for {Account}</span><span class="page-number"></span></div>
    </div>

    <div class="page">
        <div class="header"><img src="images/uctel_logo.png" alt="UCtel Logo"></div>
        <h2>Design and Installation Process</h2>
        <h3>Site Survey</h3>
        <p>In order to validate the assumptions in this proposal, a site survey is required. The survey will determine various factors including signal strength, equipment locations, and cable routes.</p>
        <h3>Report and Quotation</h3>
        <p>Following the survey, a report will be provided which will include the results of the signal survey as well as details of the solution and proposed equipment locations. A formal quotation will be provided for the installation of the solution.</p>
        <h3>Project Coordination</h3>
        <p>Once an order is received, UCtel will introduce a project coordinator to manage the installation, including scheduling, risk assessments, and ensuring smooth delivery.</p>
        <div class="footer"><span>CEL-FI {Solution} solution proposal for {Account}</span><span class="page-number"></span></div>
    </div>
    
    <div class="page">
        <div class="header"><img src="images/uctel_logo.png" alt="UCtel Logo"></div>
        <h2>Proposed Pricing</h2>
        <p>The following table provides indicative figures for the proposed solution.</p>
        <table class="pricing-table">
          <thead><tr><th>Description</th><th>Qty</th><th>Unit Price</th><th>Total Price</th></tr></thead>
          <tbody>
            <tr><td>{Description1}</td><td>{Qty1}</td><td>{UnitPrice1}</td><td>{TotalPrice1}</td></tr>
            <tr><td>{Description2}</td><td>{Qty2}</td><td>{UnitPrice2}</td><td>{TotalPrice2}</td></tr>
            <tr><td>{Description3}</td><td>{Qty3}</td><td>{UnitPrice3}</td><td>{TotalPrice3}</td></tr>
            <tr>
                <td id="support-package-description">{Description4}</td>
                <td id="support-package-qty">{Qty4}</td>
                <td id="support-package-unit-price">{UnitPrice4}</td>
                <td id="support-package-total-price">{TotalPrice4}</td>
            </tr>
            <tr class="total-row">
                <td colspan="3" style="text-align:right;">Total Price:</td>
                <td id="grand-total-price">{TotalPrice}</td>
            </tr>
        </tbody>
        </table>
        <p>The following support options are available. Please see section 7 for more details.</p>
        <table class="pricing-table">
           <thead><tr><th>Support Option</th><th>Qty</th><th>Unit Price</th><th>Total Price</th></tr></thead>
           <tbody id="support-options-body">
            <tr class="support-tier-option" data-tier="bronze"><td>{Support1}</td><td>{SupportQty1}</td><td>{SupportUnitPrice1}</td><td>{SupportTotalPrice1}</td></tr>
            <tr class="support-tier-option" data-tier="silver"><td>{Support2}</td><td>{SupportQty2}</td><td>{SupportUnitPrice2}</td><td>{SupportTotalPrice2}</td></tr>
            <tr class="support-tier-option" data-tier="gold"><td>{Support3}</td><td>{SupportQty3}</td><td>{SupportUnitPrice3}</td><td>{SupportTotalPrice3}</td></tr>
        </tbody>
        </table>
        <h3>Survey</h3>
        <p>In order to validate the above estimate a site survey is required. The price for the survey and report is {SurveyPrice} + VAT.</p>
        <div class="footer"><span>CEL-FI {Solution} solution proposal for {Account}</span><span class="page-number"></span></div>
    </div>

    <div class="page">
        <div class="header"><img src="images/uctel_logo.png" alt="UCtel Logo"></div>
        <h2>CEL-FI Support Services</h2>
        <p>The table below describes the available services that UCtel provides for the ongoing support of CEL-FI installations.</p>
        <table>
            <thead><tr><th>Included Services</th><th>Description</th><th>Bronze</th><th>Silver</th><th>Gold</th></tr></thead>
            <tbody>
                <tr><td>Reactive Support</td><td>Customer identifies issue and reports to UCtel</td><td>✅</td><td>✅</td><td>✅</td></tr>
                <tr><td>Remote Monitoring</td><td>Alerts and events captured on the management portal</td><td>☐</td><td>✅</td><td>✅</td></tr>
                <tr><td>On-site support</td><td>Engineer to site for equipment relocation or antenna repositioning</td><td>☐</td><td>☐</td><td>✅</td></tr>
            </tbody>
        </table>
        <div class="footer"><span>CEL-FI {Solution} solution proposal for {Account}</span><span class="page-number"></span></div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
<script>
    // --- CONSOLIDATED DATA FOR ALL SOLUTIONS ---
    const solutionSpecificData = {
        'G41': {
            architecture: `
                <h2>Proposed Solution</h2>
                <h3 class="no-number">CEL-FI</h3>
                <p>UCtel proposes to deploy solutions from Nextivity. Nextivity manufactures the CEL-FI suite of cellular coverage solutions which are designed to optimise mobile signal coverage within buildings and vehicles.</p>
                <h3>CEL-FI G41 System Architecture</h3>
                <p>The CEL-FI solution needs to receive the best available donor signal from outside and transport the signal through low loss cable to the network repeaters that then distribute the signal through indoor antennas.</p>
                <img src="images/g41_diagrams.png" alt="G41 Installation Diagrams">`,
            components: `
                <h2>Solution Components</h2>
                <div class="component-layout"><div class="image-container"><img src="images/donor_antenna.png"></div><div class="text-container"><h3>Donor Antenna</h3><p>One or more donor antennas will be installed on the roof to obtain the best signal for boosting.</p></div></div>
                <div class="component-layout reverse"><div class="image-container"><img src="images/g41_boosters.png"></div><div class="text-container"><h3>G41 Booster</h3><p>CEL-FI Go G41 booster(s) will be installed in a suitable location and either wall or rack-mounted.</p></div></div>
                <div class="component-layout"><div class="image-container"><img src="images/server_antennas.png"></div><div class="text-container"><h3>Server Antennas</h3><p>Depending on the environment the appropriate type of antenna will be installed.</p></div></div>`
        },
        'G43': {
            architecture: `
                <h2>Proposed Solution</h2>
                <h3 class="no-number">CEL-FI</h3>
                <p>UCtel proposes to deploy solutions from Nextivity. Nextivity manufactures the CEL-FI suite of cellular coverage solutions which are designed to optimise mobile signal coverage within buildings and vehicles.</p>
                <h3>CEL-FI G43 System Architecture</h3>
                <p>The CEL-FI solution needs to receive the best available donor signal from outside and transport the signal through low loss cable to the network repeaters that then distribute the signal through indoor antennas.</p>
                <img src="images/g43_diagram.png" alt="G43 Installation Diagram">`,
            components: `
                <h2>Solution Components</h2>
                <div class="component-layout"><div class="image-container"><img src="images/donor_antenna.png"></div><div class="text-container"><h3>Donor Antenna</h3><p>One or more donor antennas will be installed on the roof to obtain the best signal for boosting.</p></div></div>
                <div class="component-layout reverse"><div class="image-container"><img src="images/g43_booster.png"></div><div class="text-container"><h3>G43 Booster</h3><p>CEL-FI GO G43 booster(s) will be installed in a suitable location and either wall or rack-mounted.</p></div></div>
                <div class="component-layout"><div class="image-container"><img src="images/server_antennas.png"></div><div class="text-container"><h3>Server Antennas</h3><p>Depending on the environment the appropriate type of antenna will be installed.</p></div></div>`
        },
        'QUATRA': {
            architecture: `
                <h2>Proposed Solution</h2>
                <h3 class="no-number">CEL-FI</h3>
                <p>UCtel proposes to deploy solutions from Nextivity. Nextivity manufactures the CEL-FI suite of cellular coverage solutions which are designed to optimise mobile signal coverage within buildings and vehicles.</p>
                <h3>CEL-FI QUATRA 4000e</h3>
                <p>CEL-FI QUATRA is a distributed antenna system (DAS) hybrid solution that delivers a mobile signal that is up to 1000 times stronger than a pure analogue solution, utilising CAT 5e/6 cabling for RF and power over ethernet.</p>
                <img src="images/quatra_diagram.png" alt="QUATRA 4000e Architecture Diagram">`,
            components: `
                <h2>Solution Components</h2>
                <div class="component-layout"><div class="image-container"><img src="images/donor_antenna.png"></div><div class="text-container"><h3>Donor Antenna</h3><p>Donor antennas will be installed on the roof to obtain the best signal for boosting.</p></div></div>
                <div class="component-layout reverse"><div class="image-container"><img src="images/network_unit.png"></div><div class="text-container"><h3>Network Unit</h3><p>CEL-FI QUATRA 4000e Network Units (NUs) will be installed in a suitable location and either wall or rack mounted.</p></div></div>
                <div class="component-layout"><div class="image-container"><img src="images/coverage_unit.png"></div><div class="text-container"><h3>Coverage Unit</h3><p>Coverage Units are installed in each of the areas that require coverage, connected by CAT6 cables to the NU.</p></div></div>`
        },
        'QUATRA_EVO': {
            architecture: `
                <h2>Proposed Solution</h2>
                <h3 class="no-number">CEL-FI</h3>
                <p>UCtel proposes to deploy solutions from Nextivity. Nextivity manufactures the CEL-FI suite of cellular coverage solutions which are designed to optimise mobile signal coverage within buildings and vehicles.</p>
                <h3>CEL-FI QUATRA EVO</h3>
                <p>CEL-FI QUATRA is a distributed antenna system (DAS) hybrid solution that delivers a mobile signal that is up to 1000 times stronger than a pure analogue solution, utilising CAT 5e/6 cabling for RF and power over ethernet.</p>
                <img src="images/evo_diagram.png" alt="QUATRA EVO Architecture Diagram">`,
            components: `
                <h2>Solution Components</h2>
                <div class="component-layout"><div class="image-container"><img src="images/donor_antenna.png"></div><div class="text-container"><h3>Donor Antenna</h3><p>Donor antennas will be installed on the roof to obtain the best signal for boosting.</p></div></div>
                <div class="component-layout reverse"><div class="image-container"><img src="images/network_unit_evo.png"></div><div class="text-container"><h3>Network Unit</h3><p>CEL-FI QUATRA EVO Network Units (NUs) will be installed in a suitable location and either wall or rack mounted.</p></div></div>
                <div class="component-layout"><div class="image-container"><img src="images/coverage_unit.png"></div><div class="text-container"><h3>Coverage Unit</h3><p>Coverage Units are installed in each of the areas that require coverage, connected by CAT6 cables to the NU.</p></div></div>`
        }
    };

    document.addEventListener('DOMContentLoaded', () => {
        const proposalData = (function loadProposalData() {
            if (!window.location.hash) return null;
            try {
                const encodedState = window.location.hash.substring(1);
                const compressedString = atob(encodedState);
                const compressed = new Uint8Array(compressedString.length);
                for (let i = 0; i < compressedString.length; i++) { compressed[i] = compressedString.charCodeAt(i); }
                const jsonString = pako.inflate(compressed, { to: 'string' });
                return JSON.parse(jsonString);
            } catch (error) {
                console.error("Failed to load proposal data:", error);
                document.body.innerHTML = '<h1>Error: Could not load proposal data.</h1>';
                return null;
            }
        })();

        function populatePlaceholders(data) {
            if (!data) return;
            let bodyHtml = document.getElementById('proposal-container').innerHTML;
            for (const key in data) {
                const regex = new RegExp(`{${key}}`, 'g');
                bodyHtml = bodyHtml.replace(regex, data[key]);
            }
            document.getElementById('proposal-container').innerHTML = bodyHtml;
        }
        
        function populateDynamicContent(data) {
            if (!data || !data.systemType) return;
            
            const systemKey = data.systemType.replace('_DAS', '');
            const content = solutionSpecificData[systemKey];
            
            if (content) {
                const archSection = document.getElementById('solution-architecture-section');
                const compSection = document.getElementById('solution-components-section');
                if(archSection) archSection.innerHTML = content.architecture;
                if(compSection) compSection.innerHTML = content.components;
            }
        }
        
        function addInteractivity(data) {
            if (!data) return;
            const supportOptions = document.querySelectorAll('.support-tier-option');
            const grandTotalElem = document.getElementById('grand-total-price');
            const supportDescElem = document.getElementById('support-package-description');
            const supportQtyElem = document.getElementById('support-package-qty');
            const supportUnitElem = document.getElementById('support-package-unit-price');
            const supportTotalElem = document.getElementById('support-package-total-price');
            if(!grandTotalElem) return;

            const parsePrice = (priceString) => parseFloat(String(priceString).replace(/[£,]/g, ''));
            const baseTotal = parsePrice(data.TotalPrice) - parsePrice(data.TotalPrice4 || '£0.00');
            const tierPrices = { bronze: parsePrice(data.SupportTotalPrice1), silver: parsePrice(data.SupportTotalPrice2), gold: parsePrice(data.SupportTotalPrice3) };
            
            supportOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const tier = option.dataset.tier;
                    const newGrandTotal = baseTotal + tierPrices[tier];
                    supportDescElem.textContent = `Annual ${tier.charAt(0).toUpperCase() + tier.slice(1)} Support Package`;
                    supportUnitElem.textContent = `£${tierPrices[tier].toLocaleString('en-GB', {minimumFractionDigits: 2})}`;
                    supportTotalElem.textContent = `£${tierPrices[tier].toLocaleString('en-GB', {minimumFractionDigits: 2})}`;
                    grandTotalElem.textContent = `£${newGrandTotal.toLocaleString('en-GB', {minimumFractionDigits: 2})}`;
                    supportOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                });
            });
        }

        function generateDynamicTOC() {
            const tocList = document.getElementById('toc-list');
            if (!tocList) return;
            const headings = document.querySelectorAll('.page:not(.cover-page, .toc-page) h2:not(.no-number), .page:not(.cover-page, .toc-page) h3:not(.no-number)');
            let h2Counter = 0, h3Counter = 0;
            
            headings.forEach((heading) => {
                const slug = 'section-' + heading.textContent.toLowerCase().replace(/[^a-z0-9]+/g, '-');
                heading.id = slug;
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = '#' + slug;
                let displayNumber;
                if (heading.tagName === 'H2') { h2Counter++; h3Counter = 0; displayNumber = `${h2Counter}`; li.className = 'toc-h2';
                } else { h3Counter++; displayNumber = `${h2Counter}.${h3Counter}`; li.className = 'toc-h3'; }
                const pageNumber = heading.closest('.page')?.querySelector('.footer .page-number')?.textContent || '';
                a.innerHTML = `<span>${displayNumber} ${heading.textContent}</span><span>${pageNumber}</span>`;
                li.appendChild(a);
                tocList.appendChild(li);
            });
        }
        
        function addPageNumbers() {
            const pages = document.querySelectorAll('.page:not(.cover-page)');
            pages.forEach((page, index) => {
                const pageNumElem = page.querySelector('.footer .page-number');
                if(pageNumElem) pageNumElem.textContent = index + 2;
            });
        }

        // --- RUN ALL INITIALIZATION LOGIC ---
        if (proposalData) {
            populateDynamicContent(proposalData); // Must run first to build the page structure
            populatePlaceholders(proposalData);     // Then fill in the placeholders
            addInteractivity(proposalData);         // Then add interactivity
            addPageNumbers();                       // Add page numbers
            generateDynamicTOC();                   // Finally, generate TOC from the final content
        }
    });
</script>
</body>
</html>
